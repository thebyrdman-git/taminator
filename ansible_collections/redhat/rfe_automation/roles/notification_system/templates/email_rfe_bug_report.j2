<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>RFE/Bug Tracker Report - {{ customer_name }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { background-color: #cc0000; color: white; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 24px; }
        .summary { background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .section { margin-bottom: 25px; }
        .section h2 { color: #cc0000; border-bottom: 2px solid #cc0000; padding-bottom: 5px; }
        .case-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .case-table th, .case-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .case-table th { background-color: #f2f2f2; font-weight: bold; }
        .case-number { font-weight: bold; color: #cc0000; }
        .severity-1 { background-color: #ffebee; }
        .severity-2 { background-color: #fff3e0; }
        .severity-3 { background-color: #f3e5f5; }
        .severity-4 { background-color: #e8f5e8; }
        .footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #ddd; font-size: 12px; color: #666; }
        .quality-score { font-weight: bold; color: {% if data_quality_score >= 0.95 %}#4caf50{% else %}#f44336{% endif %}; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß RFE/Bug Tracker Report</h1>
            <p><strong>Customer:</strong> {{ customer_name }} | <strong>Account:</strong> {{ account_name }} | <strong>Generated:</strong> {{ report_timestamp }}</p>
        </div>

        {% if notification_include_summary %}
        <div class="summary">
            <h3>üìä Executive Summary</h3>
            <ul>
                <li><strong>Active RFEs:</strong> {{ active_rfes | length }}</li>
                <li><strong>Active Bugs:</strong> {{ active_bugs | length }}</li>
                <li><strong>Closed Cases:</strong> {{ closed_cases | length }}</li>
                <li><strong>Data Quality Score:</strong> <span class="quality-score">{{ (data_quality_score * 100) | round(1) }}%</span></li>
            </ul>
        </div>
        {% endif %}

        {% if active_rfes | length > 0 %}
        <div class="section">
            <h2>üéØ Active RFE Cases ({{ active_rfes | length }})</h2>
            <table class="case-table">
                <thead>
                    <tr>
                        <th>Case Number</th>
                        <th>Subject</th>
                        <th>Severity</th>
                        <th>Owner</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for case in active_rfes[:notification_max_cases_per_notification] %}
                    <tr class="severity-{{ case.severity.split(' ')[0] if case.severity else '4' }}">
                        <td class="case-number">{{ case.caseNumber }}</td>
                        <td>{{ case.subject[:100] }}{% if case.subject | length > 100 %}...{% endif %}</td>
                        <td>{{ case.severity if case.severity else 'N/A' }}</td>
                        <td>{{ case.caseOwner.name if case.caseOwner else 'N/A' }}</td>
                        <td>{{ case.internalStatus if case.internalStatus else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if active_rfes | length > notification_max_cases_per_notification %}
            <p><em>Showing first {{ notification_max_cases_per_notification }} of {{ active_rfes | length }} RFE cases. Full report available in portal.</em></p>
            {% endif %}
        </div>
        {% endif %}

        {% if active_bugs | length > 0 %}
        <div class="section">
            <h2>üêõ Active Bug Cases ({{ active_bugs | length }})</h2>
            <table class="case-table">
                <thead>
                    <tr>
                        <th>Case Number</th>
                        <th>Subject</th>
                        <th>Severity</th>
                        <th>Owner</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for case in active_bugs[:notification_max_cases_per_notification] %}
                    <tr class="severity-{{ case.severity.split(' ')[0] if case.severity else '4' }}">
                        <td class="case-number">{{ case.caseNumber }}</td>
                        <td>{{ case.subject[:100] }}{% if case.subject | length > 100 %}...{% endif %}</td>
                        <td>{{ case.severity if case.severity else 'N/A' }}</td>
                        <td>{{ case.caseOwner.name if case.caseOwner else 'N/A' }}</td>
                        <td>{{ case.internalStatus if case.internalStatus else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if active_bugs | length > notification_max_cases_per_notification %}
            <p><em>Showing first {{ notification_max_cases_per_notification }} of {{ active_bugs | length }} bug cases. Full report available in portal.</em></p>
            {% endif %}
        </div>
        {% endif %}

        {% if notification_include_details and closed_cases | length > 0 %}
        <div class="section">
            <h2>üìã Recent Closed Cases ({{ closed_cases | length }})</h2>
            <table class="case-table">
                <thead>
                    <tr>
                        <th>Case Number</th>
                        <th>Subject</th>
                        <th>Type</th>
                        <th>Closed Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for case in closed_cases[:10] %}
                    <tr>
                        <td class="case-number">{{ case.caseNumber }}</td>
                        <td>{{ case.subject[:80] }}{% if case.subject | length > 80 %}...{% endif %}</td>
                        <td>{{ case.caseType if case.caseType else 'N/A' }}</td>
                        <td>{{ case.lastUpdateDate if case.lastUpdateDate else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if closed_cases | length > 10 %}
            <p><em>Showing last 10 of {{ closed_cases | length }} closed cases.</em></p>
            {% endif %}
        </div>
        {% endif %}

        <div class="footer">
            <p>This report was automatically generated by the Red Hat RFE Automation System.</p>
            <p>For questions or issues, please contact your TAM or the TAM Operations team.</p>
            <p><strong>Report Quality:</strong> <span class="quality-score">{{ (data_quality_score * 100) | round(1) }}%</span> | <strong>Generated:</strong> {{ report_timestamp }}</p>
        </div>
    </div>
</body>
</html>
