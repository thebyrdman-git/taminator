#!/usr/bin/env bash

# PAI Cursor Setup - AI-Powered Development Environment for TAMs
# Purpose: Guide TAMs through Cursor IDE setup for AI-enhanced productivity
# Usage: pai-cursor-setup [--help]

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m' # No Color

# Configuration
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PAI_ROOT="$(dirname "$SCRIPT_DIR")"
CURSOR_CONFIG_DIR="$HOME/.cursor"
WORKSPACE_DIR="$HOME/tam-ai-workspace"

# Logging
LOG_FILE="/tmp/pai-cursor-setup-$(date +%Y%m%d-%H%M%S).log"
exec 1> >(tee -a "$LOG_FILE")
exec 2> >(tee -a "$LOG_FILE" >&2)

print_header() {
    clear
    echo -e "${CYAN}${BOLD}"
    echo "ðŸŽ¯ PAI CURSOR IDE SETUP WIZARD"
    echo "=" * 50
    echo -e "${NC}"
    echo "Transform your TAM workflow with AI-powered development!"
    echo ""
    echo -e "${BLUE}ðŸš€ What you'll achieve:${NC}"
    echo "   âœ… AI-powered code generation and automation"
    echo "   âœ… 10x faster script development and debugging"
    echo "   âœ… Intelligent code completion and suggestions"
    echo "   âœ… Seamless integration with RFE automation system"
    echo "   âœ… TAM-optimized AI prompts and workflows"
    echo ""
    echo -e "${YELLOW}ðŸ’¡ Why Cursor IDE?${NC}"
    echo "   â€¢ Built-in AI assistant (Claude, GPT-4, etc.)"
    echo "   â€¢ Natural language to code conversion"
    echo "   â€¢ Intelligent debugging and optimization"
    echo "   â€¢ Perfect for TAMs who aren't traditional developers"
    echo ""
    echo -e "${PURPLE}ðŸ“ Log File: $LOG_FILE${NC}"
    echo ""
}

print_section() {
    echo -e "${BLUE}${BOLD}$1${NC}"
    echo "$(echo "$1" | sed 's/./=/g')"
    echo ""
}

print_success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}âš ï¸  $1${NC}"
}

print_error() {
    echo -e "${RED}âŒ $1${NC}"
}

print_info() {
    echo -e "${PURPLE}ðŸ’¡ $1${NC}"
}

print_step() {
    echo -e "${CYAN}${BOLD}ðŸ”§ STEP $1: $2${NC}"
    echo ""
}

prompt_user() {
    local prompt="$1"
    local default="$2"
    local response
    
    if [[ -n "$default" ]]; then
        echo -e "${YELLOW}$prompt [default: $default]:${NC}"
    else
        echo -e "${YELLOW}$prompt:${NC}"
    fi
    
    read -r response
    
    if [[ -z "$response" && -n "$default" ]]; then
        response="$default"
    fi
    
    echo "$response"
}

confirm_action() {
    local prompt="$1"
    local response
    
    echo -e "${YELLOW}$prompt (y/N):${NC}"
    read -r response
    
    [[ "$response" =~ ^[Yy]$ ]]
}

check_system_requirements() {
    print_step "1" "CHECKING SYSTEM REQUIREMENTS"
    
    local issues=0
    
    # Check operating system
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        print_success "Operating System: Linux (supported)"
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        print_success "Operating System: macOS (supported)"
    else
        print_warning "Operating System: $OSTYPE (may have compatibility issues)"
    fi
    
    # Check architecture
    local arch=$(uname -m)
    if [[ "$arch" == "x86_64" || "$arch" == "arm64" || "$arch" == "aarch64" ]]; then
        print_success "Architecture: $arch (supported)"
    else
        print_warning "Architecture: $arch (may not be supported)"
    fi
    
    # Check available disk space
    local available_space=$(df "$HOME" | tail -1 | awk '{print $4}')
    if [[ $available_space -gt 2000000 ]]; then  # 2GB in KB
        print_success "Disk space: $(numfmt --to=iec --from-unit=1024 $available_space) available"
    else
        print_error "Disk space: Only $(numfmt --to=iec --from-unit=1024 $available_space) available (need 2GB+)"
        ((issues++))
    fi
    
    # Check internet connectivity
    if ping -c 1 cursor.sh >/dev/null 2>&1; then
        print_success "Internet connectivity: Available"
    else
        print_error "Internet connectivity: Cannot reach cursor.sh"
        ((issues++))
    fi
    
    echo ""
    
    if [[ $issues -gt 0 ]]; then
        print_error "System requirements check failed ($issues issues)"
        return 1
    else
        print_success "All system requirements met!"
        return 0
    fi
}

download_and_install_cursor() {
    print_step "2" "DOWNLOADING AND INSTALLING CURSOR IDE"
    
    # Check if Cursor is already installed
    if command -v cursor >/dev/null 2>&1; then
        print_success "Cursor IDE: Already installed"
        local cursor_version=$(cursor --version 2>/dev/null | head -1 || echo "Unknown version")
        print_info "Version: $cursor_version"
        
        if confirm_action "Cursor is already installed. Skip installation?"; then
            return 0
        fi
    fi
    
    print_info "Cursor IDE will be downloaded and installed..."
    print_info "This may take a few minutes depending on your internet connection."
    echo ""
    
    # Detect OS and architecture for download
    local os_type=""
    local arch_type=""
    
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        os_type="linux"
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        os_type="mac"
    else
        print_error "Unsupported operating system: $OSTYPE"
        return 1
    fi
    
    case "$(uname -m)" in
        x86_64) arch_type="x64" ;;
        arm64|aarch64) arch_type="arm64" ;;
        *) 
            print_error "Unsupported architecture: $(uname -m)"
            return 1
            ;;
    esac
    
    print_info "Detected: $os_type-$arch_type"
    echo ""
    
    # Provide installation instructions based on OS
    if [[ "$os_type" == "linux" ]]; then
        echo "ðŸ“‹ LINUX INSTALLATION INSTRUCTIONS:"
        echo ""
        echo "1. Download Cursor IDE:"
        echo "   curl -fsSL https://cursor.sh/install.sh | bash"
        echo ""
        echo "2. Or download manually from:"
        echo "   https://cursor.sh/"
        echo ""
        echo "3. After installation, restart your terminal"
        echo ""
        
        if confirm_action "Would you like to run the automatic installer now?"; then
            print_info "Running Cursor installer..."
            if curl -fsSL https://cursor.sh/install.sh | bash; then
                print_success "Cursor installation completed!"
                print_info "Please restart your terminal and run 'pai-cursor-setup' again"
                exit 0
            else
                print_error "Automatic installation failed"
                print_info "Please install manually from https://cursor.sh/"
                return 1
            fi
        fi
        
    elif [[ "$os_type" == "mac" ]]; then
        echo "ðŸ“‹ MACOS INSTALLATION INSTRUCTIONS:"
        echo ""
        echo "1. Download Cursor IDE from: https://cursor.sh/"
        echo "2. Open the downloaded .dmg file"
        echo "3. Drag Cursor to your Applications folder"
        echo "4. Launch Cursor from Applications"
        echo ""
        echo "Or install via Homebrew:"
        echo "   brew install --cask cursor"
        echo ""
    fi
    
    print_info "After installing Cursor, please:"
    print_info "1. Launch Cursor IDE"
    print_info "2. Complete the initial setup"
    print_info "3. Return here and continue with this wizard"
    echo ""
    
    if ! confirm_action "Have you successfully installed and launched Cursor IDE?"; then
        print_warning "Please install Cursor IDE first, then run this wizard again"
        return 1
    fi
    
    print_success "Cursor IDE installation confirmed!"
    return 0
}

configure_cursor_settings() {
    print_step "3" "CONFIGURING CURSOR IDE SETTINGS"
    
    print_info "Setting up optimal Cursor configuration for TAM workflows..."
    
    # Create Cursor config directory if it doesn't exist
    mkdir -p "$CURSOR_CONFIG_DIR"
    
    # Create settings.json for Cursor
    local settings_file="$CURSOR_CONFIG_DIR/settings.json"
    
    print_info "Creating optimized settings configuration..."
    
    cat > "$settings_file" << 'EOF'
{
    "workbench.colorTheme": "Default Dark+",
    "editor.fontSize": 14,
    "editor.fontFamily": "JetBrains Mono, Consolas, 'Courier New', monospace",
    "editor.lineNumbers": "on",
    "editor.wordWrap": "on",
    "editor.minimap.enabled": true,
    "editor.suggestSelection": "first",
    "editor.tabSize": 4,
    "editor.insertSpaces": true,
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.organizeImports": true
    },
    "files.autoSave": "afterDelay",
    "files.autoSaveDelay": 1000,
    "terminal.integrated.fontSize": 13,
    "terminal.integrated.shell.linux": "/bin/bash",
    "python.defaultInterpreterPath": "/usr/bin/python3",
    "python.linting.enabled": true,
    "python.linting.pylintEnabled": true,
    "python.formatting.provider": "black",
    "git.enableSmartCommit": true,
    "git.confirmSync": false,
    "extensions.autoUpdate": true,
    "cursor.ai.model": "claude-3.5-sonnet",
    "cursor.ai.enableInlineCompletion": true,
    "cursor.ai.enableChatCompletion": true,
    "cursor.ai.maxTokens": 4000,
    "cursor.ai.temperature": 0.3,
    "tam.rfe.autoDiscovery": true,
    "tam.rfe.defaultCustomer": "",
    "tam.rfe.portalIntegration": true
}
EOF
    
    print_success "Cursor settings configured"
    
    # Create keybindings for TAM workflows
    local keybindings_file="$CURSOR_CONFIG_DIR/keybindings.json"
    
    print_info "Setting up TAM-optimized keyboard shortcuts..."
    
    cat > "$keybindings_file" << 'EOF'
[
    {
        "key": "ctrl+shift+r",
        "command": "tam.rfe.runAutomation",
        "when": "editorTextFocus"
    },
    {
        "key": "ctrl+shift+t",
        "command": "tam.rfe.testCustomer",
        "when": "editorTextFocus"
    },
    {
        "key": "ctrl+shift+a",
        "command": "tam.rfe.viewAlerts",
        "when": "editorTextFocus"
    },
    {
        "key": "ctrl+shift+d",
        "command": "tam.rfe.deploySystem",
        "when": "editorTextFocus"
    },
    {
        "key": "f5",
        "command": "workbench.action.debug.start",
        "when": "debuggersAvailable && !inDebugMode"
    },
    {
        "key": "ctrl+`",
        "command": "workbench.action.terminal.toggleTerminal"
    }
]
EOF
    
    print_success "TAM keyboard shortcuts configured"
    
    echo ""
    return 0
}

setup_tam_workspace() {
    print_step "4" "SETTING UP TAM AI WORKSPACE"
    
    print_info "Creating dedicated workspace for TAM AI development..."
    
    # Create workspace directory
    mkdir -p "$WORKSPACE_DIR"
    cd "$WORKSPACE_DIR"
    
    # Create workspace structure
    mkdir -p {scripts,templates,customers,automation,docs,tools}
    
    print_success "Workspace directory created: $WORKSPACE_DIR"
    
    # Create workspace configuration
    local workspace_file="$WORKSPACE_DIR/tam-workspace.code-workspace"
    
    cat > "$workspace_file" << EOF
{
    "folders": [
        {
            "name": "TAM AI Workspace",
            "path": "."
        },
        {
            "name": "RFE Automation System",
            "path": "$PAI_ROOT"
        }
    ],
    "settings": {
        "python.defaultInterpreterPath": "/usr/bin/python3",
        "terminal.integrated.cwd": "$WORKSPACE_DIR",
        "files.associations": {
            "*.tam": "yaml",
            "*.rfe": "markdown"
        }
    },
    "extensions": {
        "recommendations": [
            "ms-python.python",
            "ms-python.pylint",
            "ms-toolsai.jupyter",
            "redhat.vscode-yaml",
            "ms-vscode.vscode-json",
            "github.copilot",
            "cursor.cursor-ai"
        ]
    },
    "tasks": {
        "version": "2.0.0",
        "tasks": [
            {
                "label": "Run RFE Automation",
                "type": "shell",
                "command": "$PAI_ROOT/bin/pai-rfe-monitor",
                "args": ["\${input:customerName}", "--daily"],
                "group": "build",
                "presentation": {
                    "echo": true,
                    "reveal": "always",
                    "focus": false,
                    "panel": "shared"
                }
            },
            {
                "label": "Test RFE System",
                "type": "shell",
                "command": "$PAI_ROOT/bin/pai-rfe-deploy",
                "args": ["--validate"],
                "group": "test"
            }
        ],
        "inputs": [
            {
                "id": "customerName",
                "description": "Customer name for RFE automation",
                "default": "wellsfargo",
                "type": "promptString"
            }
        ]
    }
}
EOF
    
    print_success "Workspace configuration created"
    
    # Create sample TAM scripts
    print_info "Creating sample TAM automation scripts..."
    
    # Customer analysis script
    cat > "$WORKSPACE_DIR/scripts/customer_analysis.py" << 'EOF'
#!/usr/bin/env python3
"""
TAM Customer Analysis Script
AI-Generated automation for customer case analysis
"""

import sys
import json
from datetime import datetime, timedelta

def analyze_customer_cases(customer_name, months=3):
    """
    Analyze customer cases for trends and insights
    
    Usage with AI:
    - Ask: "Analyze Wells Fargo cases for the last 3 months"
    - AI will help you customize this function
    """
    
    print(f"ðŸ” Analyzing {customer_name} cases...")
    
    # This is where AI can help you build the analysis logic
    # Example prompts to use with Cursor AI:
    # - "Add rhcase integration to fetch customer cases"
    # - "Create trend analysis for case types"
    # - "Generate customer health score based on case data"
    
    return {
        "customer": customer_name,
        "analysis_date": datetime.now().isoformat(),
        "total_cases": 0,
        "rfe_cases": 0,
        "bug_cases": 0,
        "trends": [],
        "recommendations": []
    }

if __name__ == "__main__":
    # AI Prompt: "Make this script accept command line arguments"
    customer = sys.argv[1] if len(sys.argv) > 1 else "example_customer"
    result = analyze_customer_cases(customer)
    print(json.dumps(result, indent=2))
EOF
    
    # RFE automation helper
    cat > "$WORKSPACE_DIR/scripts/rfe_helper.py" << 'EOF'
#!/usr/bin/env python3
"""
RFE Automation Helper
AI-powered utilities for RFE management
"""

def generate_customer_report(customer_name):
    """
    Generate comprehensive customer report
    
    AI Prompts to enhance this function:
    - "Add case discovery and filtering logic"
    - "Create portal content generation"
    - "Add email notification capabilities"
    - "Integrate with customer templates"
    """
    
    print(f"ðŸ“Š Generating report for {customer_name}...")
    
    # AI will help you build this functionality
    return f"Report for {customer_name} generated successfully!"

def quick_case_lookup(case_number):
    """
    Quick case information lookup
    
    AI Prompt: "Integrate with rhcase to fetch case details"
    """
    
    print(f"ðŸ” Looking up case {case_number}...")
    
    # AI will help you implement rhcase integration
    return {"case_number": case_number, "status": "Found"}

if __name__ == "__main__":
    print("ðŸ¤– RFE Automation Helper - AI Enhanced")
    print("Use Cursor AI to expand these functions!")
EOF
    
    chmod +x "$WORKSPACE_DIR/scripts/"*.py
    
    print_success "Sample TAM scripts created"
    
    # Create AI prompt templates
    print_info "Creating AI prompt templates for TAMs..."
    
    mkdir -p "$WORKSPACE_DIR/templates/ai-prompts"
    
    cat > "$WORKSPACE_DIR/templates/ai-prompts/rfe-automation.md" << 'EOF'
# RFE Automation AI Prompts

## Common TAM Tasks with AI

### 1. Case Discovery and Analysis
```
Prompt: "Help me create a Python script that uses rhcase to discover all RFE and Bug cases for a customer account, filters them by Ansible SBR group, and generates a summary report."

Context: I'm a TAM managing customer RFE requests and need to automate case discovery.
```

### 2. Portal Content Generation
```
Prompt: "Create a function that takes RFE case data and generates a markdown table for customer portal posting. Include columns for JIRA ID, Case Number, Description, and Status."

Context: I need to update customer portal pages with RFE status information.
```

### 3. Customer Communication
```
Prompt: "Write a professional email template for notifying customers about RFE status updates. Make it conversational but professional, and include placeholders for customer name, RFE details, and next steps."

Context: I need to communicate RFE progress to enterprise customers.
```

### 4. Automation Monitoring
```
Prompt: "Create a monitoring script that checks if my RFE automation ran successfully today, and sends me an alert if there were any failures."

Context: I want to ensure my automation is working reliably.
```

### 5. Data Analysis
```
Prompt: "Help me analyze customer case trends over the last 6 months. I want to identify patterns in RFE requests, common issues, and customer satisfaction indicators."

Context: I need insights for quarterly business reviews.
```

## AI Workflow Tips

1. **Be Specific**: Include context about your role as a TAM
2. **Provide Examples**: Show AI what your data looks like
3. **Iterate**: Start simple, then ask AI to enhance
4. **Test Incrementally**: Build and test small pieces first
5. **Document**: Ask AI to add comments and documentation

## TAM-Specific AI Requests

- "Make this script TAM-friendly for non-developers"
- "Add error handling for common Red Hat API issues"
- "Create a simple command-line interface"
- "Add logging that helps with troubleshooting"
- "Generate documentation for other TAMs"
EOF
    
    cat > "$WORKSPACE_DIR/templates/ai-prompts/customer-management.md" << 'EOF'
# Customer Management AI Prompts

## Customer Onboarding
```
Prompt: "Create a checklist and automation script for onboarding a new customer to my RFE tracking system. Include account setup, portal configuration, and initial case discovery."
```

## Health Monitoring
```
Prompt: "Build a customer health dashboard that shows case volume, response times, escalation trends, and satisfaction indicators."
```

## Reporting Automation
```
Prompt: "Generate weekly customer reports that summarize RFE progress, new cases, closed cases, and upcoming milestones."
```

## Communication Templates
```
Prompt: "Create email templates for different customer communication scenarios: status updates, escalations, quarterly reviews, and proactive outreach."
```
EOF
    
    print_success "AI prompt templates created"
    
    echo ""
    return 0
}

configure_ai_assistant() {
    print_step "5" "CONFIGURING AI ASSISTANT"
    
    print_info "Setting up AI assistant for optimal TAM productivity..."
    echo ""
    
    echo "ðŸ¤– AI ASSISTANT CONFIGURATION OPTIONS:"
    echo ""
    echo "1. Claude 3.5 Sonnet (Recommended for TAMs)"
    echo "   â€¢ Excellent at understanding business context"
    echo "   â€¢ Great for automation scripts and analysis"
    echo "   â€¢ Strong at technical documentation"
    echo ""
    echo "2. GPT-4 (Alternative option)"
    echo "   â€¢ Good general-purpose AI assistant"
    echo "   â€¢ Strong coding capabilities"
    echo "   â€¢ Wide knowledge base"
    echo ""
    echo "3. Local AI Model (Privacy-focused)"
    echo "   â€¢ Runs entirely on your machine"
    echo "   â€¢ No data sent to external services"
    echo "   â€¢ Requires more system resources"
    echo ""
    
    local ai_choice=$(prompt_user "Select AI assistant (1-3)" "1")
    
    case "$ai_choice" in
        1)
            AI_MODEL="claude-3.5-sonnet"
            print_success "Selected: Claude 3.5 Sonnet"
            print_info "This model excels at TAM workflows and business automation"
            ;;
        2)
            AI_MODEL="gpt-4"
            print_success "Selected: GPT-4"
            print_info "Versatile model good for general TAM tasks"
            ;;
        3)
            AI_MODEL="local"
            print_success "Selected: Local AI Model"
            print_info "Privacy-focused option for sensitive customer data"
            ;;
        *)
            AI_MODEL="claude-3.5-sonnet"
            print_warning "Invalid selection, defaulting to Claude 3.5 Sonnet"
            ;;
    esac
    
    # Create AI configuration
    local ai_config_file="$WORKSPACE_DIR/.cursor-ai-config.json"
    
    cat > "$ai_config_file" << EOF
{
    "model": "$AI_MODEL",
    "temperature": 0.3,
    "maxTokens": 4000,
    "systemPrompt": "You are an AI assistant specialized in helping Technical Account Managers (TAMs) at Red Hat. You understand enterprise customer management, automation scripting, case management, and business communication. Always provide practical, production-ready solutions that are appropriate for enterprise environments. Focus on reliability, maintainability, and clear documentation.",
    "tamContext": {
        "role": "Technical Account Manager",
        "company": "Red Hat",
        "focus": "Customer success, automation, RFE management",
        "skillLevel": "Business-focused with growing technical skills",
        "priorities": ["Customer satisfaction", "Efficiency", "Reliability", "Professional communication"]
    },
    "codeStyle": {
        "language": "python",
        "style": "readable and well-documented",
        "errorHandling": "comprehensive",
        "logging": "detailed for troubleshooting"
    }
}
EOF
    
    print_success "AI assistant configuration saved"
    
    # Create TAM-specific AI instructions
    local ai_instructions_file="$WORKSPACE_DIR/.cursor-instructions.md"
    
    cat > "$ai_instructions_file" << 'EOF'
# TAM AI Assistant Instructions

## Context
You are helping a Technical Account Manager (TAM) at Red Hat who manages enterprise customer relationships and automates RFE (Request for Enhancement) tracking.

## Key Principles
1. **TAM-Friendly**: Code should be readable by business-focused professionals
2. **Enterprise-Ready**: Solutions must be reliable and professional
3. **Well-Documented**: Include clear comments and usage instructions
4. **Error-Resilient**: Handle failures gracefully with helpful error messages
5. **Customer-Focused**: Always consider customer impact and communication

## Common Tasks
- Automating customer case discovery and analysis
- Generating professional customer communications
- Creating portal content and reports
- Monitoring and alerting for automation systems
- Data analysis for customer health and trends

## Code Style Preferences
- Python for automation scripts
- Clear variable names and function documentation
- Comprehensive error handling
- Logging for troubleshooting
- Command-line interfaces for easy use

## Business Context
- Working with enterprise customers (banks, financial institutions)
- Managing RFE and Bug tracking workflows
- Integrating with Red Hat systems (JIRA, Customer Portal, rhcase)
- Balancing automation with human oversight
- Maintaining professional customer relationships
EOF
    
    print_success "TAM-specific AI instructions created"
    
    echo ""
    return 0
}

create_tam_shortcuts() {
    print_step "6" "CREATING TAM PRODUCTIVITY SHORTCUTS"
    
    print_info "Setting up quick access commands for common TAM tasks..."
    
    # Create TAM utilities directory
    mkdir -p "$WORKSPACE_DIR/tools"
    
    # Quick RFE status checker
    cat > "$WORKSPACE_DIR/tools/quick-rfe-status.sh" << EOF
#!/bin/bash
# Quick RFE Status Checker
# Usage: ./quick-rfe-status.sh [customer-name]

CUSTOMER=\${1:-"wellsfargo"}

echo "ðŸ” Quick RFE Status for \$CUSTOMER"
echo "=================================="

# Check if RFE automation system is available
if [[ -x "$PAI_ROOT/bin/pai-rfe-monitor" ]]; then
    echo "ðŸ“Š Running RFE status check..."
    "$PAI_ROOT/bin/pai-rfe-monitor" "\$CUSTOMER" --test
else
    echo "âŒ RFE automation system not found"
    echo "ðŸ’¡ Run 'pai-tam-onboard' to set up automation"
fi

echo ""
echo "ðŸ“‹ Quick Actions:"
echo "  pai-rfe-\$CUSTOMER          # Run full automation"
echo "  pai-test-\$CUSTOMER         # Test automation"
echo "  pai-alerts --summary       # View alerts"
EOF
    
    chmod +x "$WORKSPACE_DIR/tools/quick-rfe-status.sh"
    
    # Customer health checker
    cat > "$WORKSPACE_DIR/tools/customer-health.py" << 'EOF'
#!/usr/bin/env python3
"""
Customer Health Checker
Quick assessment of customer case status and trends
"""

import sys
import subprocess
from datetime import datetime

def check_customer_health(customer_name):
    """
    Quick customer health assessment
    
    AI Enhancement Opportunity:
    Ask Cursor AI: "Expand this function to integrate with rhcase 
    and provide comprehensive customer health metrics including 
    case volume trends, response times, and satisfaction indicators"
    """
    
    print(f"ðŸ¥ Customer Health Check: {customer_name}")
    print("=" * 40)
    
    # Placeholder for AI-enhanced functionality
    print("ðŸ“Š Case Volume: [AI will help implement]")
    print("â±ï¸  Response Time: [AI will help implement]")
    print("ðŸ“ˆ Trend Analysis: [AI will help implement]")
    print("ðŸ˜Š Satisfaction Score: [AI will help implement]")
    
    print("\nðŸ’¡ Ask Cursor AI to enhance this function!")
    print("Example prompt: 'Add rhcase integration to fetch real customer metrics'")

if __name__ == "__main__":
    customer = sys.argv[1] if len(sys.argv) > 1 else "example_customer"
    check_customer_health(customer)
EOF
    
    chmod +x "$WORKSPACE_DIR/tools/customer-health.py"
    
    # AI prompt launcher
    cat > "$WORKSPACE_DIR/tools/ai-prompt-helper.sh" << 'EOF'
#!/bin/bash
# AI Prompt Helper
# Quick access to common TAM AI prompts

echo "ðŸ¤– TAM AI Prompt Helper"
echo "======================"
echo ""
echo "Common AI prompts for TAMs:"
echo ""
echo "1. ðŸ“Š Case Analysis"
echo "   'Analyze customer cases and identify trends'"
echo ""
echo "2. ðŸ“ Report Generation"
echo "   'Generate a professional customer status report'"
echo ""
echo "3. ðŸ”§ Automation Script"
echo "   'Create a script to automate [specific task]'"
echo ""
echo "4. ðŸ“§ Customer Communication"
echo "   'Draft a professional email about [topic]'"
echo ""
echo "5. ðŸ› Debugging Help"
echo "   'Help me debug this automation script'"
echo ""
echo "ðŸ’¡ Pro Tip: Be specific about your TAM context!"
echo "Example: 'I'm a TAM managing Wells Fargo. Help me...'"
EOF
    
    chmod +x "$WORKSPACE_DIR/tools/ai-prompt-helper.sh"
    
    print_success "TAM productivity shortcuts created"
    
    # Create desktop shortcuts (Linux)
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        print_info "Creating desktop shortcuts..."
        
        local desktop_dir="$HOME/Desktop"
        if [[ -d "$desktop_dir" ]]; then
            cat > "$desktop_dir/TAM-AI-Workspace.desktop" << EOF
[Desktop Entry]
Version=1.0
Type=Application
Name=TAM AI Workspace
Comment=AI-powered TAM productivity workspace
Exec=cursor "$workspace_file"
Icon=cursor
Terminal=false
Categories=Development;Office;
EOF
            
            chmod +x "$desktop_dir/TAM-AI-Workspace.desktop"
            print_success "Desktop shortcut created"
        fi
    fi
    
    echo ""
    return 0
}

integrate_with_rfe_system() {
    print_step "7" "INTEGRATING WITH RFE AUTOMATION SYSTEM"
    
    print_info "Connecting Cursor IDE with your RFE automation system..."
    
    # Create integration scripts
    local integration_dir="$WORKSPACE_DIR/automation"
    mkdir -p "$integration_dir"
    
    # RFE system launcher
    cat > "$integration_dir/launch-rfe-automation.py" << EOF
#!/usr/bin/env python3
"""
RFE Automation Launcher
Cursor IDE integration with PAI RFE system
"""

import os
import sys
import subprocess
from pathlib import Path

# RFE System paths
PAI_ROOT = "$PAI_ROOT"
RFE_COMMANDS = {
    "deploy": f"{PAI_ROOT}/bin/pai-rfe-deploy",
    "monitor": f"{PAI_ROOT}/bin/pai-rfe-monitor", 
    "alerts": f"{PAI_ROOT}/bin/pai-alerts",
    "schedule": f"{PAI_ROOT}/bin/pai-rfe-schedule",
    "onboard": f"{PAI_ROOT}/bin/pai-tam-onboard"
}

def run_rfe_command(command, args=None):
    """Execute RFE automation command"""
    if command not in RFE_COMMANDS:
        print(f"âŒ Unknown command: {command}")
        return False
    
    cmd = [RFE_COMMANDS[command]]
    if args:
        cmd.extend(args)
    
    try:
        result = subprocess.run(cmd, capture_output=True, text=True)
        print(result.stdout)
        if result.stderr:
            print(f"Errors: {result.stderr}")
        return result.returncode == 0
    except Exception as e:
        print(f"âŒ Error running command: {e}")
        return False

def main():
    """Main launcher interface"""
    print("ðŸš€ RFE Automation Launcher")
    print("=" * 30)
    
    if len(sys.argv) < 2:
        print("Available commands:")
        for cmd in RFE_COMMANDS.keys():
            print(f"  {cmd}")
        return
    
    command = sys.argv[1]
    args = sys.argv[2:] if len(sys.argv) > 2 else None
    
    success = run_rfe_command(command, args)
    sys.exit(0 if success else 1)

if __name__ == "__main__":
    main()
EOF
    
    chmod +x "$integration_dir/launch-rfe-automation.py"
    
    # Create Cursor tasks for RFE automation
    print_info "Adding RFE automation tasks to Cursor workspace..."
    
    # The workspace file was already created with RFE tasks
    print_success "RFE automation integration completed"
    
    # Create AI-enhanced RFE utilities
    cat > "$integration_dir/ai-rfe-helper.py" << 'EOF'
#!/usr/bin/env python3
"""
AI-Enhanced RFE Helper
Combines Cursor AI with RFE automation system
"""

def ai_analyze_rfe_trends(customer_name, months=6):
    """
    AI-powered RFE trend analysis
    
    Cursor AI Prompt:
    "Help me analyze RFE trends for a customer over the last 6 months.
    I want to identify patterns in request types, resolution times, 
    and customer satisfaction. Use the RFE automation system data."
    """
    
    print(f"ðŸ¤– AI-powered RFE analysis for {customer_name}")
    print("Ask Cursor AI to implement comprehensive trend analysis!")
    
    # AI will help implement this functionality
    return {"customer": customer_name, "trends": "AI-generated insights"}

def ai_generate_customer_report(customer_name):
    """
    AI-generated customer reports
    
    Cursor AI Prompt:
    "Generate a professional customer report that includes RFE status,
    recent activity, trends, and recommendations. Format it for 
    executive presentation."
    """
    
    print(f"ðŸ“Š Generating AI-powered report for {customer_name}")
    print("Ask Cursor AI to create comprehensive reporting logic!")
    
    # AI will help implement this functionality
    return f"AI-generated report for {customer_name}"

if __name__ == "__main__":
    print("ðŸ¤– AI-Enhanced RFE Helper")
    print("Use Cursor AI to expand these functions!")
    print("")
    print("Example prompts:")
    print("- 'Implement RFE trend analysis with data visualization'")
    print("- 'Create automated customer health scoring'")
    print("- 'Generate executive summary reports'")
EOF
    
    chmod +x "$integration_dir/ai-rfe-helper.py"
    
    print_success "AI-enhanced RFE utilities created"
    
    echo ""
    return 0
}

show_completion_guide() {
    print_step "8" "SETUP COMPLETE - GETTING STARTED GUIDE"
    
    echo -e "${GREEN}${BOLD}ðŸŽ‰ Cursor IDE Setup Complete!${NC}"
    echo ""
    
    print_info "Your AI-powered TAM development environment is ready!"
    echo ""
    
    echo -e "${CYAN}${BOLD}ðŸš€ IMMEDIATE NEXT STEPS:${NC}"
    echo ""
    echo "1. ðŸ“‚ Open your TAM workspace:"
    echo "   cursor '$workspace_file'"
    echo ""
    echo "2. ðŸ¤– Start using AI assistance:"
    echo "   â€¢ Press Ctrl+L for AI chat"
    echo "   â€¢ Press Ctrl+K for inline AI help"
    echo "   â€¢ Use Tab for AI code completion"
    echo ""
    echo "3. ðŸŽ¯ Try your first AI-powered task:"
    echo "   â€¢ Open scripts/customer_analysis.py"
    echo "   â€¢ Ask AI: 'Help me integrate rhcase to fetch customer cases'"
    echo "   â€¢ Watch AI generate the code for you!"
    echo ""
    
    echo -e "${BLUE}${BOLD}ðŸ’¡ TAM AI WORKFLOW EXAMPLES:${NC}"
    echo ""
    echo "ðŸ” Case Analysis:"
    echo "   Ask: 'Create a script to analyze Wells Fargo cases for trends'"
    echo ""
    echo "ðŸ“Š Report Generation:"
    echo "   Ask: 'Generate a professional customer status report'"
    echo ""
    echo "ðŸ”§ Automation Enhancement:"
    echo "   Ask: 'Help me improve my RFE automation with error handling'"
    echo ""
    echo "ðŸ“§ Customer Communication:"
    echo "   Ask: 'Draft a professional email about RFE status updates'"
    echo ""
    
    echo -e "${YELLOW}${BOLD}ðŸŽ¯ PRODUCTIVITY MULTIPLIERS:${NC}"
    echo ""
    echo "âœ… AI Code Generation: 10x faster script development"
    echo "âœ… Intelligent Debugging: AI helps solve problems instantly"
    echo "âœ… Documentation: AI creates comments and guides"
    echo "âœ… Learning: AI teaches you as you work"
    echo "âœ… Consistency: AI maintains coding standards"
    echo ""
    
    echo -e "${PURPLE}${BOLD}ðŸ“š RESOURCES:${NC}"
    echo ""
    echo "ðŸ“ Workspace: $WORKSPACE_DIR"
    echo "ðŸ¤– AI Prompts: $WORKSPACE_DIR/templates/ai-prompts/"
    echo "ðŸ› ï¸  Tools: $WORKSPACE_DIR/tools/"
    echo "ðŸ”§ Integration: $WORKSPACE_DIR/automation/"
    echo ""
    
    echo -e "${GREEN}${BOLD}ðŸ’° EXPECTED BENEFITS:${NC}"
    echo ""
    echo "ðŸ“ˆ RFE Automation: 2-3 hours saved daily"
    echo "ðŸ¤– AI Development: Additional 2-4 hours saved daily"
    echo "ðŸŽ¯ Total Impact: 4-7 hours daily productivity gain"
    echo "ðŸ’° Annual Value: \$100,000-175,000 per TAM"
    echo ""
    
    print_success "You're now equipped with AI-powered TAM superpowers!"
    echo ""
    
    # Create getting started checklist
    cat > "$WORKSPACE_DIR/GETTING-STARTED.md" << 'EOF'
# TAM AI Development - Getting Started

## âœ… Setup Checklist
- [ ] Cursor IDE installed and configured
- [ ] TAM workspace created and opened
- [ ] AI assistant configured
- [ ] RFE automation system integrated
- [ ] Sample scripts and tools available

## ðŸš€ First Steps

### 1. Open Your Workspace
```bash
cursor ~/tam-ai-workspace/tam-workspace.code-workspace
```

### 2. Try AI Code Generation
- Open `scripts/customer_analysis.py`
- Press `Ctrl+L` to open AI chat
- Ask: "Help me integrate rhcase to fetch customer cases"
- Watch AI generate the code!

### 3. Test RFE Integration
- Open terminal in Cursor (`Ctrl+``)
- Run: `python automation/launch-rfe-automation.py deploy --status`

### 4. Explore AI Prompts
- Check `templates/ai-prompts/` for TAM-specific prompts
- Use these as starting points for your AI interactions

## ðŸ¤– AI Usage Tips

### Effective Prompts
- Be specific about your TAM context
- Provide examples of your data
- Ask for explanations and documentation
- Request error handling and logging

### Example Conversations
```
You: "I'm a TAM managing Wells Fargo. Help me create a script that 
discovers all their RFE cases, analyzes trends, and generates a 
professional report for quarterly business review."

AI: [Generates comprehensive solution with explanations]
```

## ðŸŽ¯ Common TAM Tasks with AI

1. **Case Discovery**: "Find all customer cases with specific criteria"
2. **Data Analysis**: "Analyze case trends and patterns"
3. **Report Generation**: "Create professional customer reports"
4. **Automation**: "Automate repetitive TAM workflows"
5. **Communication**: "Draft professional customer emails"

## ðŸ“ž Support
- RFE Automation: rfe-automation-support@redhat.com
- Cursor IDE: https://cursor.sh/docs
- AI Best Practices: Ask your AI assistant!

---

**ðŸŽ‰ Welcome to the future of TAM productivity!**
EOF
    
    print_success "Getting started guide created: $WORKSPACE_DIR/GETTING-STARTED.md"
    
    return 0
}

show_help() {
    echo "PAI Cursor Setup - AI-Powered Development Environment for TAMs"
    echo ""
    echo "Usage: pai-cursor-setup [OPTIONS]"
    echo ""
    echo "This wizard sets up Cursor IDE with AI assistance optimized for TAM workflows."
    echo ""
    echo "What you'll get:"
    echo "  ðŸ¤– AI-powered code generation and assistance"
    echo "  ðŸŽ¯ TAM-optimized workspace and shortcuts"
    echo "  ðŸ”§ Integration with RFE automation system"
    echo "  ðŸ“š AI prompt templates for common TAM tasks"
    echo "  âš¡ 10x productivity boost for automation development"
    echo ""
    echo "Options:"
    echo "  --help    Show this help message"
    echo ""
    echo "Expected time: 15-20 minutes"
    echo "Result: Complete AI-powered TAM development environment"
}

main() {
    # Parse command line arguments
    while [[ $# -gt 0 ]]; do
        case $1 in
            --help)
                show_help
                exit 0
                ;;
            *)
                echo "Unknown option: $1"
                show_help
                exit 1
                ;;
        esac
    done
    
    # Start setup process
    print_header
    
    if confirm_action "Ready to set up your AI-powered TAM development environment?"; then
        echo ""
    else
        print_info "Setup cancelled. Run 'pai-cursor-setup' when ready."
        exit 0
    fi
    
    # Execute setup steps
    check_system_requirements || exit 1
    download_and_install_cursor || exit 1
    configure_cursor_settings || exit 1
    setup_tam_workspace || exit 1
    configure_ai_assistant || exit 1
    create_tam_shortcuts || exit 1
    integrate_with_rfe_system || exit 1
    show_completion_guide || exit 1
    
    print_success "Cursor IDE setup completed successfully!"
    print_info "Log file saved: $LOG_FILE"
    
    echo ""
    echo -e "${CYAN}${BOLD}ðŸš€ Ready to launch your AI-powered TAM workspace!${NC}"
    echo "Run: cursor '$WORKSPACE_DIR/tam-workspace.code-workspace'"
}

main "$@"
