# {{ customer_name }} RFE/Bug Report - {{ ansible_date_time.date }}

## Summary
- **Customer**: {{ customer_name }}
- **Account Number**: {{ account_number }}
- **Report Generated**: {{ ansible_date_time.date }} {{ ansible_date_time.time }}
- **Total Active RFEs**: {{ active_rfes | length }}
- **Total Active Bugs**: {{ active_bugs | length }}
- **Total Closed Cases (Recent)**: {{ closed_cases | length }}

---

## Active RFEs by Component

{% if active_rfes is defined and active_rfes | length > 0 %}
{% set rfe_components = active_rfes | groupby('sbrGroup') | default([]) %}
{% for component_group in rfe_components %}
### {{ component_group.grouper | default('Unknown Component') }}

| RED HAT JIRA ID | Support Case | Enhancement Request | Status |
|---|---|---|---|
{% for case in component_group.list %}
| {{ case.jira_id | default(case.caseNumber) }} | [{{ case.caseNumber | default('N/A') }}](https://access.redhat.com/support/cases/#/case/{{ case.caseNumber | default('N/A') }}) | {{ case.subject | default('No Subject') | replace('[RFE] ', '') }} | {{ case.jira_status | default(case.status) | default('Unknown') }} |
{% endfor %}

**Total {{ component_group.grouper | default('Unknown Component') }} RFEs:** {{ component_group.list | length }}

{% endfor %}
{% else %}
### No Active RFEs Found

No active RFE cases found for {{ customer_name }}.
{% endif %}

---

## Active Bugs by Component

{% if active_bugs is defined and active_bugs | length > 0 %}
{% set bug_components = active_bugs | groupby('sbrGroup') | default([]) %}
{% for component_group in bug_components %}
### {{ component_group.grouper | default('Unknown Component') }}

| RED HAT JIRA ID | Support Case | Bug Report | Status |
|---|---|---|---|
{% for case in component_group.list %}
| {{ case.jira_id | default(case.caseNumber) }} | [{{ case.caseNumber | default('N/A') }}](https://access.redhat.com/support/cases/#/case/{{ case.caseNumber | default('N/A') }}) | {{ case.subject | default('No Subject') | replace('[BUG] ', '') }} | {{ case.jira_status | default(case.status) | default('Unknown') }} |
{% endfor %}

**Total {{ component_group.grouper | default('Unknown Component') }} Bugs:** {{ component_group.list | length }}

{% endfor %}
{% else %}
### No Active Bugs Found

No active bug cases found for {{ customer_name }}.
{% endif %}

---

## Recently Closed Cases

{% if closed_cases is defined and closed_cases | length > 0 %}
| Support Case | Subject | Closed Date | Status |
|---|---|---|---|
{% for case in closed_cases %}
| [{{ case.caseNumber | default('N/A') }}](https://access.redhat.com/support/cases/#/case/{{ case.caseNumber | default('N/A') }}) | {{ case.subject | default('No Subject') | truncate(80) }} | {{ case.lastModifiedDate | default('Unknown') }} | {{ case.status | default('Unknown') }} |
{% endfor %}

**Total Recently Closed Cases:** {{ closed_cases | length }}
{% else %}
### No Recently Closed Cases Found

No recently closed cases found for {{ customer_name }}.
{% endif %}

---

## Report Notes

- **JIRA ID Logic**: Cases with external JIRA trackers show the actual JIRA ID (e.g., AAP-15272, RHEL-61730). Cases without JIRA trackers show the support case number.
- **Status Logic**: Shows JIRA status when available, otherwise shows support case status.
- **Filtering**: Only includes cases with `[RFE]` or `[BUG]` in the subject line.
- **Components**: Grouped by SBR Group (e.g., Ansible, RHEL, OpenShift).
- **Account Filter**: Filtered by account number {{ account_number }}.

---

*Report generated by Red Hat RFE/Bug Automation Tool*
*Generated on {{ ansible_date_time.date }} at {{ ansible_date_time.time }}*
