---
# Prometheus Configuration - Red Hat Best Practices
# PAI Environment Metrics Collection

prometheus:
  version: "2.47.2"
  port: 9090
  
  # Installation
  install_method: binary
  user: prometheus
  group: prometheus
  
  # Directories
  config_dir: /etc/prometheus
  data_dir: /var/lib/prometheus
  bin_dir: /usr/local/bin
  
  # Configuration
  config:
    global:
      scrape_interval: 15s
      evaluation_interval: 15s
      external_labels:
        cluster: 'pai-homelab'
        environment: 'production'
        
    alerting:
      alertmanagers:
        - static_configs:
            - targets:
                - localhost:9093
                
    rule_files:
      - "rules/*.yml"
      
    scrape_configs:
      # Prometheus self-monitoring
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']
          
      # Node Exporter - HP Server
      - job_name: 'hp-server-node'
        static_configs:
          - targets: ['192.168.1.34:9100']
        scrape_interval: 10s
        metrics_path: /metrics
        
      # Node Exporter - Plex Server  
      - job_name: 'plex-server-node'
        static_configs:
          - targets: ['192.168.1.17:9100']
        scrape_interval: 10s
        
      # Jimmy YouTube System Metrics
      - job_name: 'jimmy-youtube'
        static_configs:
          - targets: ['192.168.1.34:5001']
        metrics_path: /metrics
        scrape_interval: 30s
        
      # PAI System Metrics
      - job_name: 'pai-system'
        static_configs:
          - targets: ['192.168.1.34:8080']
        metrics_path: /pai/metrics
        scrape_interval: 60s
        
  # Retention and storage
  storage:
    retention_time: 15d
    retention_size: 10GB
    
  # Service configuration
  service:
    name: prometheus
    enabled: true
    state: started
    
# System configuration
system:
  firewall_enabled: true
  firewall_port: 9090
  
# Alerting rules for PAI environment
alerting_rules:
  - name: pai-system-alerts
    rules:
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          
      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage on {{ $labels.instance }}"
          
      - alert: DiskSpaceLow
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 10
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Low disk space on {{ $labels.instance }}"
          
      - alert: JimmyYouTubeDown
        expr: up{job="jimmy-youtube"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Jimmy YouTube system is down"
